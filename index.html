<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2D RTS Game</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: #222;
    }
    canvas {
      display: block;
      background-color: #444;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="1280" height="720"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Game State
const camera = { x: 0, y: 0 };
const keys = {};
const TILE_SIZE = 64;

// Units
const units = [{
  x: 200, y: 200, width: 20, height: 20,
  selected: false, speed: 2,
  target: { x: 200, y: 200 }
}];

// Input
let mouse = { x: 0, y: 0, worldX: 0, worldY: 0 };
let selecting = false;
let selectBoxStart = { x: 0, y: 0 };

// Listen to input
canvas.addEventListener("mousedown", (e) => {
  const rect = canvas.getBoundingClientRect();
  mouse.x = e.clientX - rect.left;
  mouse.y = e.clientY - rect.top;
  mouse.worldX = mouse.x + camera.x;
  mouse.worldY = mouse.y + camera.y;

  if (e.button === 0) {
    // Start selection box
    selecting = true;
    selectBoxStart = { x: mouse.worldX, y: mouse.worldY };
  } else if (e.button === 2) {
    // Move selected units
    for (let unit of units) {
      if (unit.selected) {
        unit.target.x = mouse.worldX;
        unit.target.y = mouse.worldY;
      }
    }
  }
});

canvas.addEventListener("mouseup", (e) => {
  if (e.button === 0 && selecting) {
    const x1 = Math.min(selectBoxStart.x, mouse.worldX);
    const y1 = Math.min(selectBoxStart.y, mouse.worldY);
    const x2 = Math.max(selectBoxStart.x, mouse.worldX);
    const y2 = Math.max(selectBoxStart.y, mouse.worldY);

    for (let unit of units) {
      unit.selected = (
        unit.x >= x1 && unit.x <= x2 &&
        unit.y >= y1 && unit.y <= y2
      );
    }
    selecting = false;
  }
});

canvas.addEventListener("contextmenu", (e) => {
  e.preventDefault(); // disable context menu
});

window.addEventListener("mousemove", (e) => {
  const rect = canvas.getBoundingClientRect();
  mouse.x = e.clientX - rect.left;
  mouse.y = e.clientY - rect.top;
  mouse.worldX = mouse.x + camera.x;
  mouse.worldY = mouse.y + camera.y;
});

window.addEventListener("keydown", (e) => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", (e) => keys[e.key.toLowerCase()] = false);

// Game Loop
function update() {
  // Camera movement
  if (keys["w"]) camera.y -= 5;
  if (keys["s"]) camera.y += 5;
  if (keys["a"]) camera.x -= 5;
  if (keys["d"]) camera.x += 5;

  // Unit movement
  for (let unit of units) {
    const dx = unit.target.x - unit.x;
    const dy = unit.target.y - unit.y;
    const dist = Math.hypot(dx, dy);
    if (dist > 1) {
      unit.x += (dx / dist) * unit.speed;
      unit.y += (dy / dist) * unit.speed;
    }
  }
}

// Rendering
function drawGrid() {
  const cols = Math.ceil(canvas.width / TILE_SIZE) + 2;
  const rows = Math.ceil(canvas.height / TILE_SIZE) + 2;

  ctx.strokeStyle = "#555";
  for (let i = -1; i < cols; i++) {
    ctx.beginPath();
    ctx.moveTo(i * TILE_SIZE - camera.x % TILE_SIZE, 0);
    ctx.lineTo(i * TILE_SIZE - camera.x % TILE_SIZE, canvas.height);
    ctx.stroke();
  }
  for (let i = -1; i < rows; i++) {
    ctx.beginPath();
    ctx.moveTo(0, i * TILE_SIZE - camera.y % TILE_SIZE);
    ctx.lineTo(canvas.width, i * TILE_SIZE - camera.y % TILE_SIZE);
    ctx.stroke();
  }
}

function drawUnits() {
  for (let unit of units) {
    ctx.fillStyle = unit.selected ? "#00ff00" : "#fff";
    ctx.fillRect(unit.x - camera.x - 10, unit.y - camera.y - 10, unit.width, unit.height);
  }
}

function drawSelectionBox() {
  if (selecting) {
    ctx.strokeStyle = "yellow";
    const sx = selectBoxStart.x - camera.x;
    const sy = selectBoxStart.y - camera.y;
    const ex = mouse.worldX - camera.x;
    const ey = mouse.worldY - camera.y;
    ctx.strokeRect(
      Math.min(sx, ex),
      Math.min(sy, ey),
      Math.abs(sx - ex),
      Math.abs(sy - ey)
    );
  }
}

function drawUI() {
  ctx.fillStyle = "white";
  ctx.font = "16px sans-serif";
  ctx.fillText("Units: " + units.length, 10, 20);
}

// Main loop
function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  update();
  drawGrid();
  drawUnits();
  drawSelectionBox();
  drawUI();
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
