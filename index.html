<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Insane 2D Arcade Shooter with Grenade</title>
<style>
  body, html {
    margin: 0; padding: 0; overflow: hidden; background: #111;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
    color: #0f0;
  }
  canvas {
    display: block;
    margin: auto;
    background: linear-gradient(135deg, #222 0%, #000 100%);
  }
  #score, #timer, #powerup-timers {
    position: fixed;
    font-weight: bold;
    text-shadow: 0 0 5px #0f0;
    font-family: monospace;
  }
  #score {
    top: 10px; left: 10px;
    font-size: 20px;
  }
  #timer {
    top: 10px; right: 10px;
    font-size: 20px;
  }
  #powerup-timers {
    bottom: 10px; left: 10px;
    font-size: 16px;
    color: #ff0;
  }
  #health-bar {
    position: fixed;
    bottom: 10px; right: 10px;
    width: 200px;
    height: 20px;
    border: 2px solid #0f0;
    background: #222;
    box-shadow: 0 0 10px #0f0 inset;
  }
  #health-bar-inner {
    height: 100%;
    width: 100%;
    background: #0f0;
  }
  #menu-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #0f0;
    font-family: monospace;
    z-index: 9999;
  }
  #menu-text {
    font-size: 48px;
    margin-bottom: 40px;
    text-align: center;
  }
  button {
    font-family: monospace;
    font-size: 20px;
    margin: 10px;
    padding: 10px 30px;
    cursor: pointer;
    background: #0f0;
    border: none;
    border-radius: 6px;
    box-shadow: 0 0 10px #0f0;
    color: #000;
    transition: background 0.3s;
  }
  button:hover {
    background: #5f5;
  }
  #pause-btn {
    position: fixed;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    background: #0a0;
    color: #fff;
    font-weight: bold;
    border-radius: 4px;
    padding: 6px 12px;
    cursor: pointer;
    box-shadow: 0 0 15px #0a0;
    user-select: none;
    z-index: 1000;
  }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="timer">Time: 0s</div>
<div id="powerup-timers"></div>
<div id="health-bar"><div id="health-bar-inner"></div></div>
<button id="pause-btn" title="Pause (P)">Pause</button>

<div id="menu-overlay">
  <div id="menu-text">INSANE 2D ARCADE SHOOTER</div>
  <button id="start-btn">Start Game</button>
  <button id="resume-btn" style="display:none;">Resume Game</button>
  <button id="restart-btn" style="display:none;">Restart Game</button>
</div>

<canvas id="game"></canvas>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  let W = window.innerWidth;
  let H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;

  // --- Game variables ---
  let score = 0;
  let gameOver = false;
  let paused = false;
  let elapsedTime = 0;
  let lastFrameTime = 0;
  let startTime = 0;
  let shootCooldown = 0;
  let lastEnemySpawn = 0;
  let enemySpawnInterval = 1000;
  let lastPowerupSpawn = 0;
  let powerupSpawnInterval = 7000;
  let shakeDuration = 0;
  let shakeMagnitude = 10;
  let bossSpawned = false;
  let boss = null;

  // --- Player ---
  const player = {
    x: W / 2,
    y: H / 2,
    radius: 20,
    speed: 6,
    color: '#0f0',
    vx: 0,
    vy: 0,
    maxHealth: 100,
    health: 100,
    powerups: {
      speedBoost: 0,
      shield: 0,
      weapon: 'pistol' // pistol, shotgun, sniper, grenade
    },
    ammo: {
      pistol: Infinity,
      grenade: 3
    }
  };

  // --- Controls ---
  const keys = {};
  window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;

    if(e.key.toLowerCase() === 'p') togglePause();

    // Weapon switching keys
    if(e.key === '1') player.powerups.weapon = 'pistol';
    else if(e.key === '2' && player.ammo.grenade > 0) player.powerups.weapon = 'grenade';
  });
  window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

  // --- Mouse ---
  let mouseX = W / 2;
  let mouseY = H / 2;
  window.addEventListener('mousemove', e => {
    mouseX = e.clientX;
    mouseY = e.clientY;
  });
  window.addEventListener('mousedown', e => keys['mouse'] = true);
  window.addEventListener('mouseup', e => keys['mouse'] = false);

  // --- Bullets ---
  const bullets = [];

  // --- Grenades ---
  const grenades = [];

  class Grenade {
    constructor(x, y, vx, vy) {
      this.x = x;
      this.y = y;
      this.vx = vx;
      this.vy = vy;
      this.radius = 10;
      this.color = '#ffa500';
      this.timer = 90; // frames until explosion (1.5 seconds at 60fps)
      this.explosionRadius = 80;
      this.exploded = false;
    }
    update() {
      if (this.exploded) return;
      // Apply gravity
      this.vy += 0.3;
      this.x += this.vx;
      this.y += this.vy;

      // Bounce off floor
      if(this.y > H - this.radius) {
        this.y = H - this.radius;
        this.vy *= -0.6; // lose some velocity on bounce
        this.vx *= 0.7;  // friction
      }
      // Bounce off walls
      if(this.x < this.radius) {
        this.x = this.radius;
        this.vx *= -0.6;
      } else if(this.x > W - this.radius) {
        this.x = W - this.radius;
        this.vx *= -0.6;
      }

      this.timer--;
      if(this.timer <= 0) {
        this.explode();
      }
    }
    explode() {
      this.exploded = true;
      createExplosion(this.x, this.y, '#ffa500', this.explosionRadius);
      sounds.explosion.currentTime = 0;
      sounds.explosion.play();

      // Damage enemies in radius
      for(let i = enemies.length -1; i >= 0; i--) {
        const e = enemies[i];
        const dist = Math.hypot(e.x - this.x, e.y - this.y);
        if(dist <= this.explosionRadius + e.radius) {
          e.health -= 5; // grenade damage
          if(e.health <= 0) {
            createExplosion(e.x, e.y, e.color);
            if(e.isBoss) bossSpawned = false;
            enemies.splice(i, 1);
            score += e.isBoss ? 100 : 10;
          }
        }
      }
    }
    draw(ctx) {
      if(this.exploded) {
        // Draw explosion circle (fading out)
        const alpha = Math.max(this.timer / 30, 0);
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.fillStyle = 'orange';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.explosionRadius, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      } else {
        // Draw grenade
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
        // fuse sparkle
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(this.x + 4, this.y - 4, 3, 0, Math.PI * 2);
        ctx.fill();
      }
    }
  }

  // --- Sounds ---
  const sounds = {
    shoot: new Audio('https://freesound.org/data/previews/320/320181_5260879-lq.mp3'),
    explosion: new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3'),
    damage: new Audio('https://freesound.org/data/previews/256/256113_3263906-lq.mp3'),
    powerup: new Audio('https://freesound.org/data/previews/331/331912_3248244-lq.mp3'),
    bossRoar: new Audio('https://freesound.org/data/previews/457/457034_5121236-lq.mp3')
  };

  // --- Utility ---
  function randRange(min, max) {
    return Math.random() * (max - min) + min;
  }

  // --- Player shoot ---
  function shoot() {
    if (gameOver || paused) return;
    if(player.powerups.weapon === 'grenade' && player.ammo.grenade <= 0) return;
    sounds.shoot.currentTime = 0;
    sounds.shoot.play();

    let dx = mouseX - player.x;
    let dy = mouseY - player.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    dx /= dist;
    dy /= dist;

    if(player.powerups.weapon === 'pistol') {
      bullets.push({
        x: player.x + dx * player.radius,
        y: player.y + dy * player.radius,
        vx: dx * 15,
        vy: dy * 15,
        radius: 5,
        color: '#0ff',
      });
    } else if(player.powerups.weapon === 'shotgun') {
      // shotgun code (left as is)
      const spreadAngle = 0.4; // radians
      const baseAngle = Math.atan2(dy, dx);
      for(let i = -2; i <= 2; i++) {
        const angle = baseAngle + i * spreadAngle / 2;
        bullets.push({
          x: player.x + Math.cos(angle) * player.radius,
          y: player.y + Math.sin(angle) * player.radius,
          vx: Math.cos(angle) * 14,
          vy: Math.sin(angle) * 14,
          radius: 5,
          color: '#0ff',
        });
      }
    } else if(player.powerups.weapon === 'sniper') {
      bullets.push({
        x: player.x + dx * player.radius,
        y: player.y + dy * player.radius,
        vx: dx * 20,
        vy: dy * 20,
        radius: 10,
        color: '#0ff',
        damage: 3,
      });
    } else if(player.powerups.weapon === 'grenade') {
      // Throw grenade with some arc
      const speed = 15;
      const grenadeVx = dx * speed;
      const grenadeVy = dy * speed - 7; // upward arc
      grenades.push(new Grenade(player.x + dx * player.radius, player.y + dy * player.radius, grenadeVx, grenadeVy));
      player.ammo.grenade--;
      if(player.ammo.grenade === 0) {
        // Automatically switch back to pistol if no grenades left
        player.powerups.weapon = 'pistol';
      }
    }
  }

  // --- Update player ---
  function updatePlayer() {
    player.vx = 0;
    player.vy = 0;
    let currentSpeed = player.speed;
    if(player.powerups.speedBoost > 0) currentSpeed *= 1.5;

    if (keys['w'] || keys['arrowup']) player.vy = -currentSpeed;
    if (keys['s'] || keys['arrowdown']) player.vy = currentSpeed;
    if (keys['a'] || keys['arrowleft']) player.vx = -currentSpeed;
    if (keys['d'] || keys['arrowright']) player.vx = currentSpeed;

    player.x += player.vx;
    player.y += player.vy;

    player.x = Math.min(Math.max(player.radius, player.x), W - player.radius);
    player.y = Math.min(Math.max(player.radius, player.y), H - player.radius);

    // Cooldowns
    if ((keys[' '] || keys['enter'] || keys['mouse']) && shootCooldown <= 0) {
      shoot();
      shootCooldown = (player.powerups.weapon === 'shotgun') ? 20 : 10;
      if(player.powerups.weapon === 'grenade') shootCooldown = 40; // grenades slower throw
    }

    if(player.powerups.speedBoost > 0) player.powerups.speedBoost--;
    if(player.powerups.shield > 0) player.powerups.shield--;
  }

  // --- Player damage ---
  function damagePlayer(amount) {
    if(player.powerups.shield > 0) return; // shield blocks damage
    player.health -= amount;
    sounds.damage.currentTime = 0;
    sounds.damage.play();
    shakeDuration = 15;
    if(player.health <= 0) {
      player.health = 0;
      gameOver = true;
      showGameOverMenu();
    }
  }

  // --- Spawn enemy ---
  function spawnEnemy(type = 'normal') {
    const side = Math.floor(randRange(0, 4));
    let x, y;
    if(side === 0) { x = randRange(0, W); y = -30; }
    else if(side === 1) { x = W + 30; y = randRange(0, H); }
    else if(side === 2) { x = randRange(0, W); y = H + 30; }
    else { x = -30; y = randRange(0, H); }

    switch(type) {
      case 'normal':
        enemies.push(new Enemy(x, y, randRange(15,25), randRange(1,3), '#f00', 1));
        break;
      case 'fast':
        enemies.push(new Enemy(x, y, 15, randRange(3,5), '#f80', 1));
        break;
      case 'tank':
        enemies.push(new Enemy(x, y, 30, randRange(0.5,1.5), '#ff0', 4));
        break;
      case 'boss':
        enemies.push(new Enemy(x, y, 80, 1.5, '#800080', 30, true));
        break;
    }
  }

  // --- Enemy class ---
  class Enemy {
    constructor(x, y, radius, speed, color, health=1, isBoss=false) {
      this.x = x;
      this.y = y;
      this.radius = radius;
      this.speed = speed;
      this.color = color;
      this.health = health;
      this.isBoss = isBoss;
      this.maxHealth = health;
      this.damage = isBoss ? 30 : (health > 2 ? 20 : 10);
    }

    update() {
      let dx = player.x - this.x;
      let dy = player.y - this.y;
      let dist = Math.sqrt(dx*dx + dy*dy);
      dx /= dist;
      dy /= dist;
      this.x += dx * this.speed;
      this.y += dy * this.speed;

      // Collide with player
      if(dist < this.radius + player.radius) {
        createExplosion(this.x, this.y, this.color);
        enemies.splice(enemies.indexOf(this), 1);
        damagePlayer(this.damage);
      }
    }

    draw(ctx) {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
      ctx.fill();

      // Eyes
      ctx.fillStyle = 'white';
      ctx.beginPath();
      ctx.arc(this.x - this.radius/3, this.y - this.radius/3, this.radius/5, 0, Math.PI*2);
      ctx.arc(this.x + this.radius/3, this.y - this.radius/3, this.radius/5, 0, Math.PI*2);
      ctx.fill();
      ctx.fillStyle = 'black';
      ctx.beginPath();
      ctx.arc(this.x - this.radius/3, this.y - this.radius/3, this.radius/10, 0, Math.PI*2);
      ctx.arc(this.x + this.radius/3, this.y - this.radius/3, this.radius/10, 0, Math.PI*2);
      ctx.fill();

      // Boss health bar
      if(this.isBoss) {
        ctx.fillStyle = '#222';
        ctx.fillRect(this.x - this.radius, this.y - this.radius - 15, this.radius*2, 8);
        ctx.fillStyle = '#f0f';
        ctx.fillRect(this.x - this.radius, this.y - this.radius - 15, this.radius*2 * (this.health / this.maxHealth), 8);
      }
    }
  }

  // --- Explosions ---
  const particles = [];
  function createExplosion(x, y, color = '#f00', radius = 30) {
    const count = 20;
    for(let i=0; i<count; i++) {
      particles.push({
        x, y,
        vx: randRange(-4,4),
        vy: randRange(-4,4),
        radius: randRange(radius/8, radius/4),
        color,
        alpha: 1,
        decay: randRange(0.01, 0.03)
      });
    }
  }

  // --- Powerups ---
  const powerups = [];
  class Powerup {
    constructor(x, y, type) {
      this.x = x;
      this.y = y;
      this.radius = 15;
      this.type = type; // speed, shield, ammo
      this.color = type === 'speed' ? '#0ff' : type === 'shield' ? '#ff0' : '#f0f';
    }
    update() {
      // simple bobbing effect
      this.y += Math.sin(Date.now()/300) * 0.5;
    }
    draw(ctx) {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
      ctx.fill();
      ctx.fillStyle = '#000';
      ctx.font = '20px monospace';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      if(this.type === 'speed') ctx.fillText('S', this.x, this.y);
      else if(this.type === 'shield') ctx.fillText('D', this.x, this.y);
      else if(this.type === 'ammo') ctx.fillText('G', this.x, this.y);
    }
  }

  // --- Enemies array ---
  const enemies = [];

  // --- Update function ---
  function update(dt) {
    if(gameOver || paused) return;

    elapsedTime += dt;

    // Spawn enemies
    if(Date.now() - lastEnemySpawn > enemySpawnInterval) {
      lastEnemySpawn = Date.now();
      let enemyType = 'normal';

      // After 30 seconds spawn tougher enemies randomly
      if(elapsedTime > 30000) {
        const r = Math.random();
        if(r < 0.5) enemyType = 'fast';
        else if(r < 0.8) enemyType = 'tank';
      }

      if(!bossSpawned && elapsedTime > 60000) {
        spawnEnemy('boss');
        bossSpawned = true;
      } else {
        spawnEnemy(enemyType);
      }
    }

    // Spawn powerups
    if(Date.now() - lastPowerupSpawn > powerupSpawnInterval) {
      lastPowerupSpawn = Date.now();
      const types = ['speed', 'shield', 'ammo'];
      const type = types[Math.floor(Math.random()*types.length)];
      powerups.push(new Powerup(randRange(50, W-50), randRange(50, H-50), type));
    }

    updatePlayer();

    if(shootCooldown > 0) shootCooldown--;

    // Update bullets
    for(let i = bullets.length-1; i>=0; i--) {
      const b = bullets[i];
      b.x += b.vx;
      b.y += b.vy;

      // Remove if out of bounds
      if(b.x < 0 || b.x > W || b.y < 0 || b.y > H) {
        bullets.splice(i,1);
        continue;
      }

      // Check collision with enemies
      for(let j = enemies.length-1; j >= 0; j--) {
        const e = enemies[j];
        const dist = Math.hypot(e.x - b.x, e.y - b.y);
        if(dist < e.radius + b.radius) {
          e.health -= (b.damage || 1);
          if(e.health <= 0) {
            createExplosion(e.x, e.y, e.color);
            if(e.isBoss) bossSpawned = false;
            enemies.splice(j, 1);
            score += e.isBoss ? 100 : 10;
          }
          bullets.splice(i, 1);
          break;
        }
      }
    }

    // Update grenades
    for(let i = grenades.length-1; i >= 0; i--) {
      const g = grenades[i];
      g.update();
      if(g.exploded && g.timer <= -30) { // remove after explosion fadeout
        grenades.splice(i, 1);
      }
    }

    // Update enemies
    enemies.forEach(e => e.update());

    // Update powerups
    for(let i = powerups.length -1; i >= 0; i--) {
      const p = powerups[i];
      p.update();

      // Collision with player
      const dist = Math.hypot(p.x - player.x, p.y - player.y);
      if(dist < p.radius + player.radius) {
        if(p.type === 'speed') {
          player.powerups.speedBoost = 600; // 10 seconds
        } else if(p.type === 'shield') {
          player.powerups.shield = 600; // 10 seconds
        } else if(p.type === 'ammo') {
          player.ammo.grenade += 2;
          sounds.powerup.currentTime = 0;
          sounds.powerup.play();
        }
        powerups.splice(i, 1);
      }
    }

    // Update particles (explosions)
    for(let i = particles.length -1; i >= 0; i--) {
      const p = particles[i];
      p.x += p.vx;
      p.y += p.vy;
      p.alpha -= p.decay;
      if(p.alpha <= 0) particles.splice(i, 1);
    }
  }

  // --- Draw function ---
  function draw() {
    // Screen shake offset
    let shakeX = 0, shakeY = 0;
    if(shakeDuration > 0) {
      shakeX = (Math.random() - 0.5) * shakeMagnitude;
      shakeY = (Math.random() - 0.5) * shakeMagnitude;
      shakeDuration--;
    }

    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.clearRect(0, 0, W, H);
    ctx.translate(shakeX, shakeY);

    // Background gradient (dynamic)
    const gradient = ctx.createLinearGradient(0, 0, W, H);
    gradient.addColorStop(0, '#022');
    gradient.addColorStop(1, '#001');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, W, H);

    // Draw player
    ctx.fillStyle = player.powerups.shield > 0 ? '#0ff' : player.color;
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2);
    ctx.fill();

    // Draw gun direction indicator
    ctx.strokeStyle = '#0ff';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(player.x, player.y);
    let gunLength = player.radius + 10;
    let dx = mouseX - player.x;
    let dy = mouseY - player.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    dx /= dist;
    dy /= dist;
    ctx.lineTo(player.x + dx * gunLength, player.y + dy * gunLength);
    ctx.stroke();

    // Draw bullets
    bullets.forEach(b => {
      ctx.fillStyle = b.color;
      ctx.beginPath();
      ctx.arc(b.x, b.y, b.radius, 0, Math.PI*2);
      ctx.fill();
    });

    // Draw grenades
    grenades.forEach(g => g.draw(ctx));

    // Draw enemies
    enemies.forEach(e => e.draw(ctx));

    // Draw powerups
    powerups.forEach(p => p.draw(ctx));

    // Draw particles
    particles.forEach(p => {
      ctx.fillStyle = p.color;
      ctx.globalAlpha = p.alpha;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
      ctx.fill();
      ctx.globalAlpha = 1;
    });

    // Draw UI
    document.getElementById('score').textContent = 'Score: ' + score;
    document.getElementById('timer').textContent = 'Time: ' + Math.floor(elapsedTime/1000) + 's';

    // Health bar
    const healthBarInner = document.getElementById('health-bar-inner');
    healthBarInner.style.width = (player.health / player.maxHealth * 100) + '%';
    healthBarInner.style.backgroundColor = player.health < 30 ? '#f00' : '#0f0';

    // Powerup timers
    const ptDiv = document.getElementById('powerup-timers');
    let ptText = '';
    if(player.powerups.speedBoost > 0) ptText += `Speed: ${(player.powerups.speedBoost/60).toFixed(1)}s `;
    if(player.powerups.shield > 0) ptText += `Shield: ${(player.powerups.shield/60).toFixed(1)}s `;
    if(player.powerups.weapon === 'grenade') ptText += `Grenades: ${player.ammo.grenade} `;
    ptDiv.textContent = ptText;
  }

  // --- Main loop ---
  function loop(timestamp = 0) {
    if(!lastFrameTime) lastFrameTime = timestamp;
    let dt = timestamp - lastFrameTime;
    lastFrameTime = timestamp;
    if(!paused && !gameOver) update(dt);
    draw();
    requestAnimationFrame(loop);
  }

  // --- Pause toggle ---
  function togglePause() {
    if(gameOver) return;
    paused = !paused;
    if(paused) {
      showPauseMenu();
    } else {
      hideMenus();
    }
  }

  // --- Menus ---
  const menuOverlay = document.getElementById('menu-overlay');
  const menuText = document.getElementById('menu-text');
  const startBtn = document.getElementById('start-btn');
  const resumeBtn = document.getElementById('resume-btn');
  const restartBtn = document.getElementById('restart-btn');
  const pauseBtn = document.getElementById('pause-btn');

  startBtn.onclick = () => {
    resetGame();
    hideMenus();
    paused = false;
  };
  resumeBtn.onclick = () => {
    hideMenus();
    paused = false;
  };
  restartBtn.onclick = () => {
    resetGame();
    hideMenus();
    paused = false;
  };

  pauseBtn.onclick = () => {
    togglePause();
  };

  function showPauseMenu() {
    menuText.textContent = 'GAME PAUSED';
    startBtn.style.display = 'none';
    resumeBtn.style.display = 'inline-block';
    restartBtn.style.display = 'inline-block';
    menuOverlay.style.display = 'flex';
  }

  function showGameOverMenu() {
    menuText.textContent = `GAME OVER\nScore: ${score}`;
    startBtn.style.display = 'none';
    resumeBtn.style.display = 'none';
    restartBtn.style.display = 'inline-block';
    menuOverlay.style.display = 'flex';
  }

  function hideMenus() {
    menuOverlay.style.display = 'none';
  }

  // --- Reset game ---
  function resetGame() {
    score = 0;
    elapsedTime = 0;
    gameOver = false;
    bossSpawned = false;
    player.health = player.maxHealth;
    player.x = W / 2;
    player.y = H / 2;
    player.powerups.weapon = 'pistol';
    player.ammo.grenade = 3;
    enemies.length = 0;
    bullets.length = 0;
    grenades.length = 0;
    powerups.length = 0;
    particles.length = 0;
    lastEnemySpawn = 0;
    lastPowerupSpawn = 0;
  }

  // --- Resize handler ---
  window.addEventListener('resize', () => {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
  });

  // --- Start ---
  resetGame();
  menuOverlay.style.display = 'flex';

  // --- Game loop start ---
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
