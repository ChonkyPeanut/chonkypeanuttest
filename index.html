<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2D RTS Game</title>
  <style>
    html, body { margin: 0; overflow: hidden; background: #111; }
    canvas { display: block; background: #222; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="1980" height="1980"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Game setup
const TILE_SIZE = 64;
const MAP_WIDTH = 2000;
const MAP_HEIGHT = 2000;

const camera = { x: 0, y: 0 };
const keys = {};
const mouse = { x: 0, y: 0, worldX: 0, worldY: 0 };
let selecting = false;
let selectStart = { x: 0, y: 0 };
const resources = { wood: 0, stone: 0 };

// Buildings and units
const buildings = [{
  x: 300, y: 300, width: 40, height: 40, type: "base"
}];

const units = [];

const trees = Array.from({ length: 30 }, () => ({
  x: Math.random() * MAP_WIDTH,
  y: Math.random() * MAP_HEIGHT,
  type: "tree",
  resource: 100
}));

const stones = Array.from({ length: 20 }, () => ({
  x: Math.random() * MAP_WIDTH,
  y: Math.random() * MAP_HEIGHT,
  type: "stone",
  resource: 100
}));

function spawnWorkerFromBase() {
  const base = buildings[0];
  units.push({
    x: base.x + 50 + Math.random() * 20,
    y: base.y + 50 + Math.random() * 20,
    width: 20,
    height: 20,
    selected: false,
    type: "worker",
    target: null,
    gathering: false
  });
}

// Input
canvas.addEventListener("mousedown", (e) => {
  mouse.x = e.offsetX;
  mouse.y = e.offsetY;
  mouse.worldX = mouse.x + camera.x;
  mouse.worldY = mouse.y + camera.y;

  if (e.button === 0) {
    selecting = true;
    selectStart = { x: mouse.worldX, y: mouse.worldY };
  } else if (e.button === 2) {
    for (let unit of units) {
      if (unit.selected) {
        unit.target = { x: mouse.worldX, y: mouse.worldY };
        unit.gathering = false;
      }
    }
  }
});
canvas.addEventListener("mouseup", (e) => {
  if (e.button === 0 && selecting) {
    const x1 = Math.min(selectStart.x, mouse.worldX);
    const y1 = Math.min(selectStart.y, mouse.worldY);
    const x2 = Math.max(selectStart.x, mouse.worldX);
    const y2 = Math.max(selectStart.y, mouse.worldY);
    for (let unit of units) {
      unit.selected = (
        unit.x >= x1 && unit.x <= x2 &&
        unit.y >= y1 && unit.y <= y2
      );
    }
    selecting = false;
  }
});
canvas.addEventListener("mousemove", (e) => {
  mouse.x = e.offsetX;
  mouse.y = e.offsetY;
  mouse.worldX = mouse.x + camera.x;
  mouse.worldY = mouse.y + camera.y;
});
canvas.addEventListener("contextmenu", e => e.preventDefault());
window.addEventListener("keydown", (e) => {
  keys[e.key.toLowerCase()] = true;
  if (e.key === "1") {
    spawnWorkerFromBase();
  }
});
window.addEventListener("keyup", (e) => {
  keys[e.key.toLowerCase()] = false;
});

// Game loop
function update() {
  if (keys["w"]) camera.y -= 5;
  if (keys["s"]) camera.y += 5;
  if (keys["a"]) camera.x -= 5;
  if (keys["d"]) camera.x += 5;

  for (let unit of units) {
    if (unit.target) {
      const dx = unit.target.x - unit.x;
      const dy = unit.target.y - unit.y;
      const dist = Math.hypot(dx, dy);
      if (dist > 1) {
        unit.x += (dx / dist) * 2;
        unit.y += (dy / dist) * 2;
      } else {
        unit.target = null;
      }
    }

    // Auto-gathering
    if (unit.type === "worker" && !unit.target && !unit.gathering) {
      for (let tree of trees) {
        if (tree.resource > 0 && Math.hypot(tree.x - unit.x, tree.y - unit.y) < 30) {
          unit.gathering = true;
          setInterval(() => {
            if (tree.resource > 0) {
              tree.resource -= 5;
              resources.wood += 5;
            }
          }, 1000);
          break;
        }
      }
      for (let stone of stones) {
        if (stone.resource > 0 && Math.hypot(stone.x - unit.x, stone.y - unit.y) < 30) {
          unit.gathering = true;
          setInterval(() => {
            if (stone.resource > 0) {
              stone.resource -= 5;
              resources.stone += 5;
            }
          }, 1000);
          break;
        }
      }
    }
  }
}

// Draw functions
function drawMap() {
  ctx.fillStyle = "#2b2b2b";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function drawResources() {
  for (let tree of trees) {
    if (tree.resource <= 0) continue;
    ctx.fillStyle = "#2f4";
    ctx.fillRect(tree.x - camera.x, tree.y - camera.y, 16, 16);
  }
  for (let stone of stones) {
    if (stone.resource <= 0) continue;
    ctx.fillStyle = "#aaa";
    ctx.fillRect(stone.x - camera.x, stone.y - camera.y, 16, 16);
  }
}

function drawBuildings() {
  for (let b of buildings) {
    ctx.fillStyle = "#44f";
    ctx.fillRect(b.x - camera.x, b.y - camera.y, b.width, b.height);
    ctx.fillStyle = "#fff";
    ctx.font = "12px sans-serif";
    ctx.fillText("B", b.x - camera.x + 12, b.y - camera.y + 25);
  }
}

function drawUnits() {
  for (let u of units) {
    // Unit body
    ctx.fillStyle = "#fff";
    ctx.fillRect(u.x - camera.x - 10, u.y - camera.y - 10, u.width, u.height);

    // Unit label
    ctx.fillStyle = "#000";
    ctx.font = "14px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText(u.type[0].toUpperCase(), u.x - camera.x, u.y - camera.y + 5);

    // Selection outline
    if (u.selected) {
      ctx.strokeStyle = "#0f0";
      ctx.lineWidth = 2;
      ctx.strokeRect(u.x - camera.x - 12, u.y - camera.y - 12, u.width + 4, u.height + 4);
    }
  }
}

function drawSelectionBox() {
  if (selecting) {
    const x1 = selectStart.x - camera.x;
    const y1 = selectStart.y - camera.y;
    const x2 = mouse.worldX - camera.x;
    const y2 = mouse.worldY - camera.y;
    ctx.fillStyle = "rgba(0, 120, 255, 0.2)";
    ctx.fillRect(Math.min(x1, x2), Math.min(y1, y2), Math.abs(x1 - x2), Math.abs(y1 - y2));
    ctx.strokeStyle = "rgba(0, 120, 255, 0.8)";
    ctx.strokeRect(Math.min(x1, x2), Math.min(y1, y2), Math.abs(x1 - x2), Math.abs(y1 - y2));
  }
}

function drawUI() {
  ctx.fillStyle = "#fff";
  ctx.font = "16px sans-serif";
  ctx.textAlign = "left";
  ctx.fillText(`Wood: ${resources.wood} | Stone: ${resources.stone}`, 20, 30);
  ctx.fillText("1 = Spawn Worker (Base Only)", 20, 50);
}

// Main loop
function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  update();
  drawMap();
  drawResources();
  drawBuildings();
  drawUnits();
  drawSelectionBox();
  drawUI();
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
